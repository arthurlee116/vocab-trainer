# AI词汇训练平台 E2E测试实现提示词

## 项目概述

你需要在AI词汇训练平台中实现完整的端到端(E2E)测试套件。这是一个基于React + Express的全栈应用，使用AI技术（Gemini 2.5 Flash + Polaris Alpha）提供动态词汇练习功能。

## 技术栈信息

### 前端技术栈
- **框架**: React 19.1.1 + TypeScript 5.9.3
- **构建工具**: Vite 7.1.7
- **状态管理**: Zustand 5.0.8
- **路由**: React Router 7.9.5
- **HTTP客户端**: Axios 1.13.2
- **UI组件**: Lucide React 0.552.0

### 后端技术栈
- **框架**: Express 5.1.0 + TypeScript 5.9.3
- **数据库**: SQLite 12.4.1
- **认证**: JWT + bcryptjs
- **AI集成**: OpenRouter API (Gemini 2.5 Flash + Polaris Alpha)
- **日志**: Winston 3.18.3

### 现有测试框架
- **E2E测试**: Playwright 1.56.1 (已配置)
- **前端单元测试**: Vitest + React Testing Library
- **后端单元测试**: Vitest

## 项目结构

```
vocab-trainer/
├── client/                 # 前端应用
│   ├── src/
│   │   ├── pages/         # 页面组件
│   │   ├── components/    # 共享组件
│   │   ├── store/         # Zustand状态管理
│   │   ├── lib/           # 工具库和API客户端
│   │   └── types/         # 类型定义
│   └── package.json
├── server/                 # 后端API
│   ├── src/
│   │   ├── routes/        # API路由
│   │   ├── services/      # 业务服务
│   │   ├── db/            # 数据库
│   │   └── middleware/    # 中间件
│   └── package.json
├── e2e/                   # E2E测试目录
│   └── landing.spec.ts    # 现有测试文件
├── playwright.config.ts    # Playwright配置
└── package.json           # 根目录配置
```

## 核心用户流程

### 1. 游客模式完整流程
```
访问网站 → 游客模式 → 上传词表 → 确认词汇 → 答题练习 → 查看报告
```

### 2. 登录用户完整流程
```
注册/登录 → 上传词表 → 确认词汇 → 答题练习 → 查看报告 → 历史记录管理
```

### 3. 关键页面路由
- `/` - LandingPage (登录/注册/游客入口)
- `/dashboard` - DashboardPage (主控制台)
- `/practice/upload` - UploadPage (上传词表)
- `/practice/confirm` - ConfirmWordsPage (确认词汇)
- `/practice/details` - VocabularyDetailsPage (词汇详情)
- `/practice/quiz` - QuizPage (答题练习)
- `/practice/report` - ReportPage (练习报告)
- `/history` - HistoryPage (历史记录)

## E2E测试实现要求

### 1. 测试框架配置

#### 1.1 Playwright配置优化
需要优化现有的Playwright配置，主要包括：
- 设置合理的全局超时时间和断言超时时间。
- 配置并行执行测试以提高效率。
- 在CI环境下启用重试机制。
- 配置多种浏览器环境（Chromium, Firefox, Webkit）。
- 设置测试基准URL和追踪/录屏策略（失败时保留）。
- 配置本地开发服务器的自动启动。

#### 1.2 测试环境设置
- 创建测试专用的环境变量配置
- 设置测试数据库（SQLite内存数据库）
- 配置测试用的AI API Mock（避免真实API调用）

### 2. 测试数据管理策略

#### 2.1 测试数据准备
应准备一套标准的测试数据，包括：
- **测试词汇表**: 包含不同难度的单词列表。
- **测试图片**: 准备标准清晰图片、模糊图片等用于测试OCR功能。
- **测试账号**: 预设的测试用户邮箱和密码。

#### 2.2 Mock策略
- 使用Playwright的 `route` 功能Mock AI API响应
- 创建预设的测试数据响应
- 模拟网络延迟和错误情况

### 3. 核心测试用例实现

#### 3.1 认证流程测试 (`auth.spec.ts`)
测试应覆盖以下场景：
- **注册流程**: 验证用户能否成功填写注册表单并自动登录。
- **登录流程**: 验证已注册用户能否使用正确凭据登录。
- **游客模式**: 验证用户能否以游客身份进入系统并看到相应提示。
- **页面跳转**: 验证各流程成功后是否正确跳转至Dashboard页面。

#### 3.2 完整练习流程测试 (`practice-flow.spec.ts`)
测试应覆盖从上传到报告的完整闭环：
- **上传阶段**: 模拟文件上传，验证图片识别等待状态。
- **确认阶段**: 验证识别出的词汇列表是否正确显示。
- **生成阶段**: 选择难度，触发题目生成，验证等待状态。
- **答题阶段**: 模拟用户进行答题交互（选择选项、切换题目）。
- **报告阶段**: 验证答题结束后能否正确展示分析报告。
- **历史记录**: 对于登录用户，验证练习记录是否成功保存到历史记录中。

#### 3.3 错误处理测试 (`error-handling.spec.ts`)
重点测试系统的健壮性：
- **网络异常**: 模拟API请求失败或超时，验证前端是否显示友好的错误提示及重试按钮。
- **文件格式错误**: 上传不支持的文件类型，验证系统是否拦截并提示。
- **服务端错误**: 模拟后端服务500错误，验证前端的容错处理和恢复机制。

#### 3.4 响应式设计测试 (`responsive.spec.ts`)
验证应用在不同设备上的表现：
- **多设备模拟**: 使用Playwright模拟iPhone, iPad, Desktop等不同视口尺寸。
- **布局适配**: 验证导航栏、侧边栏在移动端和桌面端的不同表现（如汉堡菜单与侧边栏的切换）。
- **功能可用性**: 确保核心交互在小屏幕上依然可用且无遮挡。

#### 3.5 性能测试 (`performance.spec.ts`)
关注关键性能指标：
- **加载速度**: 验证首屏加载时间（LCP）和首次输入延迟（FID）符合标准。
- **大数据量处理**: 模拟上传包含大量词汇的图片，验证系统的处理时间和响应能力是否在可接受范围内。

### 4. 测试工具和辅助函数

#### 4.1 测试工具库 (`e2e/helpers/testHelpers.ts`)
封装通用的测试操作以提高代码复用性：
- **登录/游客模式封装**: 快速进入登录状态的辅助函数。
- **文件上传封装**: 处理文件选择器交互的函数。
- **答题模拟**: 自动完成整个quiz流程的脚本。
- **Mock数据注入**: 统一管理API Mock响应的函数。
- **等待机制**: 封装智能等待逻辑，避免硬编码的timeout。

#### 4.2 页面对象模型 (`e2e/pageObjects/`)
采用Page Object Model (POM) 设计模式：
- **LandingPage**: 封装首页的登录、注册、游客模式入口交互。
- **DashboardPage**: 封装主控台的导航和状态验证。
- **QuizPage**: 封装答题页面的题目显示、选项点击、翻页等交互逻辑。
通过POM分离测试逻辑与页面细节，提高测试的可维护性。

### 5. 测试执行和报告

#### 5.1 测试脚本配置
配置npm scripts以支持不同的测试运行模式：
- 默认无头模式运行。
- 带界面的调试模式运行。
- 生成并展示测试报告。
- UI交互式模式。

#### 5.2 CI/CD集成
在GitHub Actions等CI环境中配置自动化测试流程：
- 触发条件：代码推送或Pull Request。
- 环境搭建：安装Node.js, 依赖包及Playwright浏览器。
- 执行测试：运行E2E测试套件。
- 结果归档：上传测试报告作为构建产物，便于失败排查。

### 6. 测试数据和Mock管理

#### 6.1 测试图片准备
在 `e2e/test-data/` 目录下组织不同类型的测试文件，包括正常图片、大尺寸图片、损坏文件等，以覆盖各种上传场景。

#### 6.2 Mock数据管理
建立统一的Mock数据文件，定义API接口的模拟响应结构，包括：
- VLM识别结果 Mock
- 题目生成数据 Mock
- 分析报告数据 Mock
确保Mock数据结构与真实API保持一致。

### 7. 测试最佳实践

#### 7.1 测试编写规范

1. **测试命名规范**
   - 使用描述性的测试名称
   - 采用"应该做什么"的命名方式
   - 包含测试场景和预期结果

2. **测试结构规范**
   ```typescript
   test('测试场景描述', async ({ page }) => {
     // Arrange: 准备测试数据和环境
     await setupTestData();
     
     // Act: 执行用户操作
     await performUserAction();
     
     // Assert: 验证结果
     await expect(result).toBe(expected);
   });
   ```

3. **选择器规范**
   - 优先使用语义化选择器（role、label、text）
   - 避免使用CSS类名作为选择器
   - 使用 `data-testid` 作为最后选择

#### 7.2 等待策略

```typescript
// 好的做法：使用具体的等待条件
await expect(page.getByText('加载完成')).toBeVisible();
await expect(page).toHaveURL(/\/dashboard/);

// 避免：固定时间等待
await page.waitForTimeout(3000); // 不推荐
```

#### 7.3 测试隔离

- 每个测试应该是独立的，不依赖其他测试
- 使用 `beforeEach` 和 `afterEach` 清理测试状态
- 避免在测试之间共享状态

#### 7.4 错误处理

```typescript
test('网络错误恢复', async ({ page }) => {
  // 模拟网络错误
  await page.route('**/api/**', route => route.abort());
  
  // 执行操作
  await performAction(page);
  
  // 验证错误处理
  await expect(page.getByText('网络连接失败')).toBeVisible();
  
  // 恢复网络并重试
  await page.unroute('**/api/**');
  await page.getByRole('button', { name: '重试' }).click();
  
  // 验证恢复成功
  await expect(page.getByText('操作成功')).toBeVisible();
});
```

### 8. 验收标准

#### 8.1 功能覆盖要求

- [ ] 认证流程（注册、登录、游客模式）
- [ ] 完整练习流程（上传→确认→答题→报告）
- [ ] 历史记录管理
- [ ] 错误处理和边界情况
- [ ] 响应式设计适配
- [ ] 性能基准测试

#### 8.2 质量标准

- **测试覆盖率**: 关键用户流程100%覆盖
- **通过率**: 所有测试在CI环境中稳定通过
- **执行时间**: 完整测试套件在10分钟内完成
- **维护性**: 测试代码清晰、可读、易于维护

#### 8.3 报告要求

- 生成详细的HTML测试报告
- 包含失败测试的截图和视频
- 提供性能指标数据
- 支持测试结果的趋势分析

### 9. 实施步骤

1. **环境准备**
   - 安装Playwright浏览器
   - 准备测试数据和Mock
   - 配置CI/CD环境

2. **基础测试实现**
   - 实现认证流程测试
   - 实现核心练习流程测试
   - 建立测试工具库

3. **高级测试实现**
   - 添加错误处理测试
   - 实现响应式测试
   - 添加性能测试

4. **集成和优化**
   - 配置CI/CD集成
   - 优化测试执行时间
   - 完善测试报告

5. **文档和维护**
   - 编写测试文档
   - 建立测试维护流程
   - 培训团队成员

## 总结

这个E2E测试实现方案提供了完整的测试框架，覆盖了AI词汇训练平台的所有核心功能。通过系统性的测试设计，确保应用在各种场景下都能稳定运行，为用户提供可靠的词汇学习体验。

实施这个测试方案将显著提高代码质量，减少生产环境bug，并为后续功能开发提供坚实的测试基础。
